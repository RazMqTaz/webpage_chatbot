<!DOCTYPE html>
<html>
<head>
  <title>Live STT</title>
  <style>
    #transcript { font-size: 1.2em; }
    .partial { color: gray; font-style: italic; }
    .final { color: black; font-weight: normal; }
  </style>
</head>
<body>
  <h1>Live Speech-to-Text</h1>
  <div id="transcript"></div>

  <script>
    const ws = new WebSocket("ws://localhost:8000/ws/transcribe");
    let partialSpan = null;

    ws.onmessage = event => {
      const part = JSON.parse(event.data);
      if (!part.text) return;

      const transcriptDiv = document.getElementById("transcript");

      if (part.is_final) {
        // Remove partial display
        if (partialSpan) {
          transcriptDiv.removeChild(partialSpan);
          partialSpan = null;
        }

        // Append final text
        const finalSpan = document.createElement("span");
        finalSpan.className = "final";
        finalSpan.textContent = part.text;
        transcriptDiv.appendChild(finalSpan);
      } else {
        // Replace partial text instead of accumulating
        if (!partialSpan) {
          partialSpan = document.createElement("span");
          partialSpan.className = "partial";
          transcriptDiv.appendChild(partialSpan);
        }
        partialSpan.textContent = part.text;
      }
    };
  </script>
</body>
</html>
